7.4	Physical random access channel
A UE determines a transmission power for a physical random access channel (PRACH), P_(PRACH,b,f,c) (i), on active UL BWP b of carrier f of cell c based on DL RS for cell c in transmission occasion i as 
	P_(PRACH,b,f,c) (i)=min{P_(CMAX,f,c) (i),P_(PRACH,target,f,c)+〖PL〗_(b,f,c) } [dBm],
where 
-	P_(CMAX,f,c) (i) is the UE configured maximum output power defined in [8-1, TS 38.101-1], [8-2, TS 38.101-2], [8-3, TS 38.101-3] and [8-5, TS 38.101-5] for carrier f of cell c within transmission occasion i, 
-	P_(PRACH,target,f,c) is the PRACH target reception power PREAMBLE_RECEIVED_TARGET_POWER provided by higher layers [11, TS 38.321] for the active UL BWP b of carrier f of cell c, and
-	〖PL〗_(b,f,c) is a pathloss for the active UL BWP b of carrier f based on the DL RS associated with the PRACH transmission on the active DL BWP of cell c and calculated by the UE in dB as referenceSignalPower – higher layer filtered RSRP in dBm, where RSRP is defined in [7, TS 38.215] and the higher layer filter configuration is defined in [12, TS 38.331]. If the active DL BWP is the initial DL BWP and for SS/PBCH block and CORESET multiplexing pattern 2 or 3 as described in clause 13, or for a non-serving cell, the UE determines 〖PL〗_(b,f,c) based on the SS/PBCH block associated with the PRACH transmission.
If a PRACH transmission from a UE is not in response to a detection of a PDCCH order by the UE, or is in response to a detection of a PDCCH order by the UE that triggers a contention based random access procedure, or is associated with a link recovery procedure where a corresponding index q_new is associated with a SS/PBCH block, as described in clause 6, referenceSignalPower is provided by ss-PBCH-BlockPower. 
If a PRACH transmission from a UE is in response to a detection of a PDCCH order by the UE that triggers a contention-free random access procedure, and if a pathloss offset indicator field in the PDCCH order [5, TS 38.212] indicates to the UE to apply pl-Offset that is included in an indicated TCI-State or a TCI-UL-State and has value 〖PL〗_(b,f,c,offset) in dB, where 〖PL〗_(b,f,c,offset) can be updated by a MAC CE [11, TS 38.321], the UE sets 〖PL〗_(b,f,c)=〖PL〗_(b,f,c)-〖PL〗_(b,f,c,offset) for the PRACH transmission.
If a PRACH transmission from a UE is in response to a detection of a PDCCH order by the UE that triggers a contention-free random access procedure and depending on the DL RS that the DM-RS of the PDCCH order is quasi-collocated with as described in clause 10.1 
-	when the PRACH association indicator is not present in the PDCCH order, or 
-	when the cell indicator field in the PDCCH order is not present or has value 0, or 
-	when a value of a PRACH association indicator field in the PDCCH order is 0 if the UE is not provided SSB-MTC-AdditionalPCI, or 
-	when the PRACH association indicator field in the PDCCH order indicates a physCellId associated with the cell of the PDCCH order reception, 
or depending on an indicated SS/PBCH block 
-	when the PRACH transmission is on a non-serving cell indicated by the cell indicator field in the PDCCH order, or 
-	when a value of a PRACH association indicator field in the PDCCH order is 1 if the UE is not provided SSB-MTC-AdditionalPCI, or 
-	when the PRACH association indicator field in the PDCCH order indicates a physCellId that is different than the physCellId associated with the cell of the PDCCH order reception, 
referenceSignalPower is provided by a corresponding ss-PBCH-BlockPower. 
When a value of a PRACH association indicator field in the PDCCH order is 1 if the UE is not provided SSB-MTC-AdditionalPCI, or when the PRACH association indicator field in the PDCCH order indicates a physCellId that is different that the physCellId associated with the cell of the PDCCH order reception, the UE expects that the indicated SS/PBCH block in the PDCCH order is configured as pathlossReferenceRS-Id of an active TCI state. 
If the UE is configured resources for a periodic CSI-RS reception or the PRACH transmission is associated with a link recovery procedure where a corresponding index q_new is associated with a periodic CSI-RS configuration as described in clause 6, referenceSignalPower is obtained by ss-PBCH-BlockPower and powerControlOffsetSS where powerControlOffsetSS provides an offset of CSI-RS transmission power relative to SS/PBCH block transmission power [6, TS 38.214]. If powerControlOffsetSS is not provided to the UE, the UE assumes an offset of 0 dB. If the active TCI state for the PDCCH that provides the PDCCH order includes two RS, the UE expects that one RS is configured with qcl-Type set to 'typeD' and the UE uses the one RS when applying a value provided by powerControlOffsetSS.
If within a random access response window, as described in clause 8.2, the UE does not receive a random access response that contains a preamble identifier corresponding to the preamble sequence transmitted by the UE, or when a random access response does not exist, the UE determines a transmission power for a subsequent PRACH transmission, if any, as described in [11, TS 38.321].
If prior to a PRACH retransmission, a UE changes the spatial domain transmission filter, Layer 1 notifies higher layers to suspend the power ramping counter as described in [11, TS 38.321].
If due to power allocation to PUSCH/PUCCH/PRACH/SRS transmissions as described in clause 7.5, or due to power allocation in EN-DC or NE-DC or NR-DC operation, or due to slot format determination as described in clause 11.1, or due to the PUSCH/PUCCH/PRACH/SRS transmission occasions are in the same slot or the gap between a PRACH transmission and PUSCH/PUCCH/SRS transmission is small as described in clause 8.1, or due to DAPS operation as described in clause 15, or due to HD-UE operation in paired spectrum as described in clause 17.2, the UE does not transmit a PRACH in a transmission occasion, or does not transmit any of N_preamble^rep preamble repetitions of a PRACH as described in Clause 8.1, Layer 1 notifies higher layers to suspend the corresponding power ramping counter. 
If due to power allocation to PUSCH/PUCCH/PRACH/SRS transmissions as described in clause 7.5, or due to power allocation in EN-DC or NE-DC or NR-DC operation, the UE transmits a PRACH with reduced power in a transmission occasion, or transmits one or more of N_preamble^rep preamble repetitions of a PRACH with reduced power, Layer 1 may notify higher layers to suspend the corresponding power ramping counter.
If the UE transmits less than N_preamble^rep preamble repetitions of a PRACH, Layer 1 may notify higher layers to suspend the corresponding power ramping counter.


8	Random access procedure
Prior to initiation of the physical random access procedure, Layer 1 receives from higher layers a set of SS/PBCH block indexes and provides to higher layers a corresponding set of RSRP measurements.
Prior to initiation of the physical random access procedure, Layer 1 may receive from higher layers an indication to perform a Type-1 random access procedure, as described in clauses 8.1 through 8.4, or a Type-2 random access procedure as described in clauses 8.1 through 8.2A. 
In the remaining of this clause, when a symbol is not stated as an SBFD symbol, the symbol is a non-SBFD symbol.
Prior to initiation of the physical random access procedure, Layer 1 may receive from higher layers an indication to perform a random access procedure using: 
-	first PRACH occasions each including only symbols that are indicated as uplink or flexible by tdd-UL-DL-ConfigurationCommon and considered as uplink for the random access procedure, or 
-	second PRACH occasions, that are in RBs that are both in the active UL BWP and in the UL sub-band, and associated either only with SBFD symbols that include at least one SBFD symbol indicated as downlink by tdd-UL-DL-ConfigurationCommon when the UE is provided either sbfd-RACHSingleConfig or sbfd-RACHDualConfig, or start from an SBFD symbol and end in a non-SBFD symbols when the UE is provided sbfd-RACHDualConfig and sbfd-RACHDualConfig-ValidROAcrossSymbolTypes 
The procedures in clause 8.1 apply separately for the first PRACH occasions and the second PRACH occasions. Only a Type-1 random access procedure is applicable for the second PRACH occasions. 
Prior to initiation of the physical random access procedure, Layer 1 receives the following information from the higher layers:
-	Configuration of physical random access channel (PRACH) transmission parameters (PRACH preamble format, time resources, and frequency resources for PRACH transmission).
-	Parameters for determining the root sequences and their cyclic shifts in the PRACH preamble sequence set (index to logical root sequence table, cyclic shift (N_CS), and set type (unrestricted, restricted set A, or restricted set B)).
From the physical layer perspective, the Type-1 L1 random access procedure includes the transmission of random access preamble (Msg1) in a PRACH, random access response (RAR) message with a PDCCH/PDSCH (Msg2), and when applicable, the transmission of a PUSCH scheduled by a RAR UL grant, and PDSCH for contention resolution.
From the physical layer perspective, the Type-2 L1 random access procedure includes the transmission of random access preamble in a PRACH and of a PUSCH (MsgA) and the reception of a RAR message with a PDCCH/PDSCH (MsgB), and when applicable, the transmission of a PUSCH scheduled by a fallback RAR UL grant, and PDSCH for contention resolution.
If a random access procedure is initiated by a PDCCH order to the UE, a PRACH transmission is with a same SCS as a PRACH transmission initiated by higher layers.
If a UE is configured with two UL carriers for a serving cell or a candidate cell and the UE detects a PDCCH order, the UE uses the UL/SUL indicator field value from the detected PDCCH order to determine the UL carrier for the corresponding PRACH transmission. If a UE is configured with two UL carriers for a candidate cell and the UE detects an LTM Cell Switch Command MAC CE [11, TS 38.321] that initiated a CFRA, the UE uses the S/U field value from the MAC CE to determine the UL carrier for the corresponding PRACH transmission.
If a random access procedure is initiated by a PDCCH order and the UE is provided either sbfd-RACHSingleConfig or sbfd-RACHDualConfig, the PDCCH order indicates [5, TS 38.212] whether the UE uses a PRACH occasion associated with either the first PRACH occasions or the second PRACH occasions, for the PRACH transmission that is initiated by the PDCCH order.
8.1	Random access preamble
Physical random access procedure for a UE is triggered upon request of a PRACH transmission by higher layers or by a PDCCH order or LTM Cell Switch Command MAC CE in clause 6.1.3.75 [11, TS 38.321] for a cell. A configuration by higher layers for a PRACH transmission includes the following: 
-	A configuration for PRACH transmission on the cell [4, TS 38.211]. 
-	A preamble index, a preamble SCS, P_(PRACH,target), a corresponding RA-RNTI when applicable [11, TS 38.321], and a PRACH resource for the cell. 
-	A number of N_preamble^rep>1 preamble repetitions for the PRACH transmission if the UE would transmit the PRACH with repetitions. 
A UE transmits a PRACH on a cell using the selected PRACH format with transmission power P_(PRACH,b,f,c) (i), as described in clause 7.4, on the indicated PRACH resource or on a determined set of N_preamble^rep resources using a same spatial filter in case of N_preamble^rep preamble repetitions.
For Type-1 random access procedure, a UE can be provided, by addl-RACH-Config-Adaptation in RACH-ConfigCommon, parameters for determining time resources and frequency resources for PRACH transmission [4, TS 38.211]. When a PRACH occasion associated with addl-RACH-Config-Adaptation has same frequency resource and same time resource as a PRACH occasion in RACH-ConfigCommon that is not associated with addl-RACH-Config-Adaptation, the former PRACH occasion is not valid and is not considered in the procedures in this clause. 
For valid PRACH occasions associated with addl-RACH-Config-Adaptation in RACH-ConfigCommon, the UE can be additionally provided a PRACH mask index, by prach-SubsetMask-Index-Adaptation, that indicates one or more association periods per K_mask association pattern periods according to Table 8.1-0, where K_mask is provided by KforAPPForPRACHsubsetMask. 
Table 8.1-0: Mapping of mask index to association periods per Kmask association pattern periods
Mask Index	Association periods (APs) per K_mask association pattern periods (APPs)
0	First half of APs in K_mask APPs
1	First quarter of APs in K_mask APPs
2	First eighth of APs in K_mask APPs
3	First sixteenth of APs in K_mask APPs
Valid PRACH occasions associated with addl-RACH-Config-Adaptation, and additionally in association periods indicated by prach-SubsetMask-Index-Adaptation, if provided, are indicated as available for PRACH transmission based on an indication in a DCI format 1_0 with CRC scrambled by a P-RNTI or a C-RNTI [5, TS 38.212]. For indication by DCI format 1_0 with CRC scrambled by the P-RNTI, the PRACH occasions are available for a duration provided by validity-DurationForAddlRACHAdaptation, starting from the first frame of the SI modification period [12, TS 38.331] that includes a PDCCH monitoring occasion where the UE receives a PDCCH providing the DCI format 1_0 with CRC scrambled by the P-RNTI.
In the following, for determining valid PRACH occasions, if a UE is not provided SS/PBCH block indexes by ssb-PositionsInBurst in ServingCellConfigCommon and is provided od-ssb-Config, reference to SS/PBCH blocks is for the union of SS/PBCH blocks provided by each combination of od-ssb-PositionsInBurst and od-ssb-Periodicity in od-ssb-Config. If the UE is provided SS/PBCH block indexes by ssb-PositionsInBurst in ServingCellConfigCommon and is provided od-ssb-Config, reference to SS/PBCH blocks is for the union of SS/PBCH blocks provided by ssb-Periodicity and ssb-PositionsInBurst in ServingCellConfigCommon and by each combination of od-ssb-PositionsInBurst and od-ssb-Periodicity in od-ssb-Config.
In the following, for determining an association between PRACH occasions and SS/PBCH block indexes, if a UE is not provided SS/PBCH block indexes by ssb-PositionsInBurst in ServingCellConfigCommon and is provided od-ssb-Config, reference to SS/PBCH block indexes provided by ssb-PositionsInBurst in ServingCellConfigCommon is for the union of SS/PBCH block indexes provided by each od-ssb-PositionsInBurst in od-ssb-Config. If the UE is provided SS/PBCH block indexes by ssb-PositionsInBurst in ServingCellConfigCommon and is provided od-ssb-Config, reference to SS/PBCH block indexes provided by ssb-PositionsInBurst in ServingCellConfigCommon is for the union of SS/PBCH block indexes provided by ssb-PositionsInBurst in ServingCellConfigCommon and by each od-ssb-PositionsInBurst in od-ssb-Config.
For Type-1 random access procedure, a UE is provided a number N of SS/PBCH block indexes associated with one PRACH occasion and a number R of contention based preambles per SS/PBCH block index per valid PRACH occasion either by ssb-perRACH-OccasionAndCB-PreamblesPerSSB or by ssb-perRACH-OccasionAndCB-PreamblesPerSSB-r19. 
For Type-2 random access procedure with common configuration of PRACH occasions with Type-1 random access procedure, a UE is provided a number N of SS/PBCH block indexes associated with one PRACH occasion by ssb-perRACH-OccasionAndCB-PreamblesPerSSB and a number Q of contention based preambles per SS/PBCH block index per valid PRACH occasion by msgA-CB-PreamblesPerSSB-PerSharedRO. The PRACH transmission can be on a subset of PRACH occasions associated with a same SS/PBCH block index within an SSB-RO mapping cycle for a UE provided with a PRACH mask index by msgA-SSB-SharedRO-MaskIndex according to [11, TS 38.321].
For Type-2 random access procedure with separate configuration of PRACH occasions with Type-1 random access procedure, a UE is provided a number N of SS/PBCH block indexes associated with one PRACH occasion and a number R of contention based preambles per SS/PBCH block index per valid PRACH occasion by msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB when provided; otherwise, by ssb-perRACH-OccasionAndCB-PreamblesPerSSB.
For a random access procedure associated with a feature combination indicated by FeatureCombinationPreambles, a UE is provided a number N of SS/PBCH block indexes associated with one PRACH occasion by ssb-perRACH-OccasionAndCB-PreamblesPerSSB or msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB when provided and a number S of contention based preambles per SS/PBCH block index per valid PRACH occasion by startPreambleForThisPartition and numberOfPreamblesPerSSB-ForThisPartition. The PRACH transmission can be on a subset of PRACH occasions associated with a same SS/PBCH block index within an SSB-RO mapping cycle for a UE provided with a PRACH mask index by ssb-SharedRO-MaskIndex according to [11, TS 38.321].
For Type-1 random access procedure, or for Type-2 random access procedure with separate configuration of PRACH occasions from Type 1 random access procedure, if N<1, one SS/PBCH block index is mapped to 1⁄N consecutive valid PRACH occasions and R contention based preambles with consecutive indexes associated with the SS/PBCH block index per valid PRACH occasion start from preamble index 0. If N≥1, R contention based preambles with consecutive indexes associated with SS/PBCH block index n, 0≤n≤N-1, per valid PRACH occasion start from preamble index n (〖⋅N〗_preamble^total)⁄N where N_preamble^total is provided by totalNumberOfRA-Preambles for Type-1 random access procedure, or by msgA-TotalNumberOfRA-Preambles for Type-2 random access procedure with separate configuration of PRACH occasions from a Type 1 random access procedure, and is an integer multiple of N. 
For Type-2 random access procedure with common configuration of PRACH occasions with Type-1 random access procedure, if N<1, one SS/PBCH block index is mapped to 1⁄N consecutive valid PRACH occasions and Q contention based preambles with consecutive indexes associated with the SS/PBCH block index per valid PRACH occasion start from preamble index R. If N≥1, Q contention based preambles with consecutive indexes associated with SS/PBCH block index n, 0≤n≤N-1, per valid PRACH occasion start from preamble index n (〖⋅N〗_preamble^total)⁄N+R, where N_preamble^total is provided by totalNumberOfRA-Preambles for Type-1 random access procedure.
For link recovery, a UE is provided N SS/PBCH block indexes associated with one PRACH occasion by ssb-perRACH-Occasion in BeamFailureRecoveryConfig. For a dedicated RACH configuration provided by RACH-ConfigDedicated, if cfra is provided, a UE is provided N SS/PBCH block indexes associated with one PRACH occasion by ssb-perRACH-Occasion in occasions. For the PRACH transmission on a candidate cell [38.213, clause 21], a UE is provided N SS/PBCH block indexes associated with one PRACH occasion by ssb-PerRACH-Occasion-r18 in EarlyUL-SyncConfig. If N<1, one SS/PBCH block index is mapped to 1⁄N consecutive valid PRACH occasions. If N≥1, all consecutive N SS/PBCH block indexes are associated with one PRACH occasion. 
SS/PBCH block indexes provided by ssb-PositionsInBurst in SIB1 or in ServingCellConfigCommon or in SSB-MTC-AdditionalPCI or in LTM-SSB-Config are mapped to valid PRACH occasions in the following order where the parameters are described in [4, TS 38.211]. The mapping of SS/PBCH block indexes to valid PRACH occasions is separate for valid PRACH occasions determined by RACH-ConfigCommon and for valid PRACH occasions determined by addl-RACH-Config-Adaptation.
-	First, in increasing order of preamble indexes within a single PRACH occasion
-	Second, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions
-	Third, in increasing order of time resource indexes for time multiplexed PRACH occasions within a PRACH slot
-	Fourth, in increasing order of indexes for PRACH slots
An association period, starting from frame 0, for mapping SS/PBCH block indexes to PRACH occasions is the smallest integer number in the set determined by the PRACH configuration period according to Table 8.1-1 such that N_Tx^SSB SS/PBCH block indexes are mapped at least once to the PRACH occasions within the association period, where a UE obtains N_Tx^SSB from the value of ssb-PositionsInBurst in SIB1 or in ServingCellConfigCommon or in SSB-MTC-AdditionalPCI or in LTM-SSB-Config. If after an integer number of SS/PBCH block indexes to PRACH occasions mapping cycles within the association period there is a set of PRACH occasions or PRACH preambles that are not mapped to N_Tx^SSB SS/PBCH block indexes, no SS/PBCH block indexes are mapped to the set of PRACH occasions or PRACH preambles. An association pattern period includes one or more association periods and is determined so that a pattern between PRACH occasions and SS/PBCH block indexes repeats at most every 160 msec. PRACH occasions not associated with SS/PBCH block indexes after an integer number of association periods, if any, are not used for PRACH transmissions.
Table 8.1-1: Mapping between PRACH configuration period and SS/PBCH block to PRACH occasion association period
PRACH configuration period (msec)	Association period (number of PRACH configuration periods)
10	{1, 2, 4, 8, 16}
20	{1, 2, 4, 8}
40	{1, 2, 4}
80	{1, 2}
160	{1}

For a PRACH transmission by a UE triggered by a PDCCH order or an LTM cell switch command MAC CE, the PRACH mask index field, if the value of the random access preamble index field is not zero, indicates the PRACH occasion for the PRACH transmission where the PRACH occasions are associated with the SS/PBCH block index indicated by the SS/PBCH block index field of the PDCCH order or the LTM cell switch command MAC CE and, if any, a cell indicator field in PDCCH order [5, TS 38.212] or a Target Configuration ID field in LTM cell switch command MAC CE [11, TS 38.321] indicates a cell for the PRACH transmission. If the UE is provided K_(cell,offset) by cellSpecificKoffset, the PRACH occasion is after slot n+〖2^μ∙K〗_(cell,offset) where n is the slot of the UL BWP for the PRACH transmission that overlaps with the end of the PDCCH order reception assuming T_TA=0, and μ is the SCS configuration for the PRACH transmission. If the PDCCH reception for the PDCCH order includes two PDCCH candidates from two linked search space sets based on searchSpaceLinkingId, as described in clause 10.1, the last symbol of the PDCCH reception is the last symbol of the PDCCH candidate that ends later. The PDCCH reception includes the two PDCCH candidates also when the UE is not required to monitor one of the two PDCCH candidates as described in clauses 10 (except clause 10.4), 11.1, 11.1.1 and 17.2.
For a PRACH transmission triggered by higher layers, if ssb-ResourceList is provided, the PRACH mask index is indicated by ra-ssb-OccasionMaskIndex which indicates the PRACH occasions for the PRACH transmission where the PRACH occasions are associated with the selected SS/PBCH block index.
The PRACH occasions are mapped consecutively per corresponding SS/PBCH block index. The indexing of the PRACH occasion indicated by the mask index value is reset per mapping cycle of consecutive PRACH occasions per SS/PBCH block index. The UE selects for a PRACH transmission the PRACH occasion indicated by PRACH mask index value for the indicated SS/PBCH block index in the first available mapping cycle. 
For the indicated preamble index, the ordering of the PRACH occasions is
-	First, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions
-	Second, in increasing order of time resource indexes for time multiplexed PRACH occasions within a PRACH slot
-	Third, in increasing order of indexes for PRACH slots 
For a PRACH transmission with N_preamble^rep preamble repetitions, a set consists of N_preamble^rep valid PRACH occasions that are consecutive in time, use same frequency resources, and are associated with same one or more SS/PBCH block index(es), and each SS/PBCH block index is associated with same preamble indexes in all valid PRACH occasions within the set.
For a PRACH transmission with preamble repetitions, a time period, starting from frame 0, is the smallest integer number of association pattern periods such that at least one set of valid PRACH occasions for each of the N_Tx^SSB SS/PBCH block indexes can be determined within the time period for all configured number of preamble repetitions for each supported feature combination provided in each RACH-ConfigCommon. The set(s) of valid PRACH occasions for each configured number of preamble repetitions repeats every time period.
Within a time period, for set(s) of N_preamble^rep valid PRACH occasions for a PRACH transmission with N_preamble^rep preamble repetitions 
-	the first valid PRACH occasion of the first set is the first valid PRACH occasion 
-	the first valid PRACH occasion of subsequent sets, if any, is determined according to an ordering of valid PRACH occasions 
-	first, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions
-	second, in increasing order of time resource indexes for time multiplexed PRACH occasions 
where, for each frequency resource index for frequency multiplexed PRACH occasions
-	the first valid PRACH occasion of the first set is the first valid PRACH occasion 
-	the first valid PRACH occasion of subsequent sets, if any,  
-	is after msg1-RepetitionTimeOffsetROGroup consecutive valid PRACH occasions in time from the first valid PRACH occasion of the previous set, where each PRACH occasion is associated with same SS/PBCH block index(es) and each SS/PBCH block index is associated with same preambles, if msg1-RepetitionTimeOffsetROGroup is provided 
-	is after the PRACH occasions for the previous set, if msg1-RepetitionTimeOffsetROGroup is not provided
For a PRACH transmission with preamble repetitions in CFRA procedure, msg1-RepetitionTimeOffsetROGroup is determined by the FeatureCombinationPreambles indicating msg1-Repetitions with same value as msg1-RepetitionNum provided by RACH-ConfigDedicated.
For a PRACH transmission triggered upon request by higher layers, a value of ra-OccasionList [12, TS 38.331], if csirs-ResourceList is provided, indicates a list of PRACH occasions for the PRACH transmission where the PRACH occasions are associated with the selected CSI-RS index indicated by csi-RS. The indexing of the PRACH occasions indicated by ra-OccasionList is reset per association pattern period.
For paired spectrum or supplementary uplink band all PRACH occasions are valid. 
For unpaired spectrum, 
-	if a UE is not provided tdd-UL-DL-ConfigurationCommon for a cell, a PRACH occasion for the cell in a PRACH slot is valid if it does not precede a SS/PBCH block in the PRACH slot and starts at least N_gap symbols after a last SS/PBCH block reception symbol, where N_gap is provided in Table 8.1-2 and, if channelAccessMode = "semiStatic" is provided, does not overlap with a set of consecutive symbols before the start of a next channel occupancy time where the UE does not transmit [15, TS 37.213]
-	the candidate SS/PBCH block index of the SS/PBCH block corresponds to the SS/PBCH block index provided by ssb-PositionsInBurst in SIB1 or in ServingCellConfigCommon or in SSB-MTC-AdditionalPCI corresponding to the cell, as described in clause 4.1
-	for each of the candidate cells configured by LTM-Config, if a UE is not provided ltm-TDD-UL-DL-ConfigurationCommon, a PRACH occasion in a PRACH slot for a candidate cell is valid if it does not precede a SS/PBCH block in the PRACH slot and starts at least N_gap symbols after a last SS/PBCH block reception symbol, where N_gap is provided in Table 8.1-2
-	the SS/PBCH block index of the SS/PBCH block corresponds to the SS/PBCH block index provided by ssb-PositionsInBurst in LTM-SSB-Config corresponding to the candidate cell
-	if a UE is provided tdd-UL-DL-ConfigurationCommon for a cell, a PRACH occasion for the cell in a PRACH slot is valid if 
-	it is only within UL symbols, or 
-	it is only within SBFD symbols, that include at least one SBFD symbol indicated as downlink by tdd-UL-DL-ConfigurationCommon, and in RBs that are both in the active UL BWP and in the UL sub-band if the UE is provided either sbfd-RACHSingleConfig or sbfd-RACHDualConfig, or it starts from an SBFD symbol and ends in a non-SBFD symbols and is in RBs that are both in the active UL BWP and in the UL sub-band if the UE is provided sbfd-RACHDualConfig and sbfd-RACHDualConfig-ValidROAcrossSymbolTypes, or 
-	it does not precede a SS/PBCH block in the PRACH slot, if it is only in UL symbols, and starts at least N_gap symbols after a last downlink symbol and at least N_gap symbols after a last SS/PBCH block symbol, where N_gap is provided in Table 8.1-2, and if channelAccessMode = "semiStatic" is provided, does not overlap with a set of consecutive symbols before the start of a next channel occupancy time where there shall not be any transmissions, as described in [15, TS 37.213]
-	the candidate SS/PBCH block index of the SS/PBCH block corresponds to the SS/PBCH block index provided by ssb-PositionsInBurst in SIB1 or in ServingCellConfigCommon or in SSB-MTC-AdditionalPCI corresponding to the cell, as described in clause 4.1 
-	for each of the candidate cells configured by LTM-config, if a UE is provided ltm-tdd-UL-DL-ConfigurationCommon, a PRACH occasion in a PRACH slot for a candidate cell is valid if 
-	it is within UL symbols, or 
-	it does not precede a SS/PBCH block in the PRACH slot and starts at least N_gap symbols after a last downlink symbol and at least N_gap symbols after a last SS/PBCH block symbol, where N_gap is provided in Table 8.1-2
-	the SS/PBCH block index of the SS/PBCH block corresponds to the SS/PBCH block index provided by ssb-PositionsInBurst in LTM-SSB-Config corresponding to the candidate cell. 
For preamble format B4 [4, TS 38.211], N_gap=0. 
Table 8.1-2: N_gap values for different preamble SCS μ
Preamble SCS	N_gap
1.25 kHz or 5 kHz	0
15 kHz or 30 kHz or 60 kHz or 120 kHz	2
480 kHz	8
960 kHz	16

If a random access procedure is initiated by a PDCCH order, the UE, if requested by higher layers, transmits a PRACH in the selected PRACH occasion, as described in [11, TS 38.321], for which a time between the last symbol of the PDCCH order reception and the first symbol of the PRACH transmission is larger than or equal to N_(T,2)+∆_BWPSwitching+∆_Delay+T_switch+T_SSB+∆_(RF/BB preparation) msec, where 
-	N_(T,2) is a time duration of N_2 symbols corresponding to a PUSCH preparation time for UE processing capability 1 [6, TS 38.214] assuming μ corresponds to the smallest SCS configuration between the SCS configuration of the PDCCH order and the SCS configuration of the corresponding PRACH transmission 
-	∆_BWPSwitching=0 if the active UL BWP does not change, or if a cell indicator field in the PDCCH order indicates a non-serving cell [5, TS 38.212], and ∆_BWPSwitching is a time duration of T_BWPswitchDelay defined in [10, TS 38.133] otherwise 
-	∆_Delay=0.5 msec for FR1 and ∆_Delay=0.25 msec for FR2
-	T_switch is a switching gap duration as defined in [6, TS 38.214] 
-	T_SSB=0 if a cell indicator field in the PDCCH order indicates a serving cell or if cell indicator field is not present, and T_SSB is defined in [10, TS 38.133] otherwise
-	∆_(RF/BB preparation)=0 if a cell indicator field in the PDCCH order indicates a serving cell or if cell indicator field is not present, and ∆_(RF/BB preparation) is defined in [10, TS 38.133] otherwise
For a PRACH transmission using 1.25 kHz or 5 kHz SCS, the UE determines N_2 assuming SCS configuration μ=0.
For single cell operation or for operation with contiguous carrier aggregation in a same frequency band or for operation with non-contiguous carrier aggregation in a same frequency band if the UE is not provided with intraBandNC-PRACH-simulTx-r17, a UE 
-	does not transmit PRACH and PUSCH/PUCCH/SRS in a same slot with respect to the smallest SCS configuration between the SCS configuration for the UL BWP with the PRACH and the SCS configuration for the UL BWP with the PUSCH/PUCCH/SRS transmissions
-	does not transmit PRACH and PUSCH/PUCCH/SRS when a first or last symbol of a PRACH transmission in a first slot is separated by less than N symbols from the last or first symbol, respectively, of a PUSCH/PUCCH/SRS transmission in a second slot; for a PRACH transmission with N_preamble^rep>1 preamble repetitions, this applies to each preamble repetition
-	for a PRACH transmission with N_preamble^rep>1 preamble repetitions, if the UE does not indicate prach-Repetition, the UE does not transmit a first repetition of the PRACH and a second repetition of the PRACH when a first or last symbol of the first repetition of the PRACH in a first slot is separated by less than N symbols from the last or first symbol, respectively, of the second  repetition of the PRACH in a second slot; otherwise, the UE transmits the first repetition of the PRACH and the second repetition of the PRACH
where N=2 for μ=0 or μ=1, N=4 for μ=2 or μ=3, N=16 for μ=5, N=32 for μ=6, and μ is the smallest SCS configuration between the SCS configuration for the UL BWP with the PRACH and the SCS configuration for the UL BWP with the PUSCH/PUCCH/SRS transmissions. For a PUSCH transmission with repetition Type B, this applies to each actual repetition for PUSCH transmission [6, TS 38.214].
For a UE configured with SSB-MTC-AdditionalPCI, it does not transmit PRACH and receive SS/PBCH associated with different cells in a same slot.
8.1A	PUSCH for Type-2 random access procedure
For a Type-2 random access procedure, a UE transmits a PUSCH, when applicable, after transmitting a PRACH. The UE encodes a transport block provided for the PUSCH transmission using redundancy version number 0. The PUSCH transmission is after the PRACH transmission by at least N symbols where N=2 for μ=0 or μ=1, N=4 for μ=2 or μ=3, N=16 for μ=5, N=32 for μ=6, and μ is the SCS configuration for the active UL BWP.
A UE does not transmit a PUSCH in a PUSCH occasion if the PUSCH occasion associated with a DMRS resource is not mapped to a preamble of valid PRACH occasions or if the associated PRACH preamble is not transmitted as described in clause 7.5 or clause 11.1 or clause 15 or clause 17.2. A UE can transmit a PRACH preamble in a valid PRACH occasion if the PRACH preamble is not mapped to a valid PUSCH occasion.
A mapping between one or multiple PRACH preambles and a PUSCH occasion associated with a DMRS resource is per PUSCH configuration provided by MsgA-PUSCH-Resource.
A UE determines time resources and frequency resources for PUSCH occasions in an active UL BWP from msgA-PUSCH-Config or separateMsgA-PUSCH-Config for the active UL BWP. If the active UL BWP is not the initial UL BWP and msgA-PUSCH-Config or separateMsgA-PUSCH-Config is not provided for the active UL BWP, the UE uses the msgA-PUSCH-Config or separateMsgA-PUSCH-Config provided for the initial UL BWP.
A UE determines a first interlace or first RB for a first PUSCH occasion in an active UL BWP respectively from interlaceIndexFirstPO-MsgA-PUSCH or from frequencyStartMsgA-PUSCH that provides an offset, in number of RBs in the active UL BWP, from a first RB of the active UL BWP. A PUSCH occasion includes a number of interlaces or a number of RBs provided by nrofInterlacesPerMsgA-PO or by nrofPRBs-perMsgA-PO, respectively. Consecutive PUSCH occasions in the frequency domain of an UL BWP are separated by a number of RBs provided by guardBandMsgA-PUSCH. A number N_f  of PUSCH occasions in the frequency domain of an UL BWP is provided by nrofMsgA-PO-FDM. 
For operation with shared spectrum channel access, if the PUSCH occasion is provided by higher layer parameters frequencyStartMsgA-PUSCH and nrofPRBs-perMsgA-PO, the UE expects a PUSCH occasion to be confined within the same RB set as the corresponding PRACH transmission.
For operation with shared spectrum channel access, if the PUSCH occasion is provided by higher layer parameters interlaceIndexFirstPO-MsgA-PUSCH and nrofInterlacesPerMsgA-PO, the RB set for the PUSCH occasion in the active UL BWP is the same RB set as the corresponding PRACH transmission. The UE assumes that the RB set is defined as when the UE is not provided intraCellGuardBandsPerSCS for an UL carrier as described in clause 7 of [6, TS 38.214].
If a UE does not have dedicated RRC configuration, or has an initial UL BWP as an active UL BWP, or is not provided startSymbolAndLengthMsgA-PO, msgA-PUSCH-timeDomainAllocation provides a SLIV and a PUSCH mapping type for a PUSCH transmission by indicating 
-	one of the first maxNrofUL-Allocations values from PUSCH-TimeDomainResourceAllocationList, if PUSCH-TimeDomainResourceAllocationList is provided in PUSCH-ConfigCommon
-	one of the entries from table 6.1.2.1.1-2 or table 6.1.2.1.1-3 in [6, TS 38.214], if PUSCH-TimeDomainResourceAllocationList is not provided in PUSCH-ConfigCommon
else, the UE is provided a SLIV by startSymbolAndLengthMsgA-PO, and a PUSCH mapping type by mappingTypeMsgA-PUSCH for a PUSCH transmission. 
For mapping one or multiple preambles of a PRACH slot to a PUSCH occasion associated with a DMRS resource, a UE determines a first slot for a first PUSCH occasion in an active UL BWP from msgA-PUSCH-TimeDomainOffset that provides an offset, in number of slots in the active UL BWP, relative to the start of a PUSCH slot including the start of each PRACH slot. The UE does not expect to have a PRACH preamble transmission and a PUSCH transmission with a msgA in a PRACH slot or in a PUSCH slot, or to have overlapping msgA PUSCH occasions for a MsgA PUSCH configuration. The UE expects that a first PUSCH occasion in each slot has a same SLIV for a PUSCH transmission that is provided by startSymbolAndLengthMsgA-PO or msgA-PUSCH-timeDomainAllocation [6, TS 38.214]. 
Consecutive PUSCH occasions within each slot are separated by guardPeriodMsgA-PUSCH symbols and have same duration. A number N_t of time domain PUSCH occasions in each slot is provided by nrofMsgA-PO-perSlot and a number N_s of consecutive slots that include PUSCH occasions is provided by nrofSlotsMsgA-PUSCH. 
A UE is provided a DMRS configuration for a PUSCH transmission in a PUSCH occasion in an active UL BWP by msgA-DMRS-Config.
A UE is provided an MCS for data information in a PUSCH transmission for a PUSCH occasion by msgA-MCS.
For a PUSCH transmission with frequency hopping in a slot, when indicated by msgA-intraSlotFrequencyHopping for the active UL BWP, the frequency offset for the second hop [6, TS 38.214] is determined as described in clause 8.3, Table 8.3-1 using msgA-HoppingBits instead of N_(UL,hop). If guardPeriodMsgA-PUSCH is provided, a first symbol of the second hop is separated by guardPeriodMsgA-PUSCH symbols from the end of a last symbol of the first hop; otherwise, there is no time separation of the PUSCH transmission before and after frequency hopping. If a UE is provided with useInterlacePUCCH-PUSCH in BWP-UplinkCommon, the UE shall transmit PUSCH without frequency hopping. A PUSCH transmission uses a same spatial filter as an associated PRACH transmission. 
A UE determines whether or not to apply transform precoding for a PUSCH transmission as described in [6, TS 38.214].
A PUSCH occasion for PUSCH transmission is defined by a frequency resource and a time resource, and is associated with a DMRS resource. The DMRS resources are provided by msgA-DMRS-Config.
Each consecutive number of N_"preamble"  preamble indexes from valid PRACH occasions in a PRACH slot
-	first, in increasing order of preamble indexes within a single PRACH occasion
-	second, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions
-	third, in increasing order of time resource indexes for time multiplexed PRACH occasions within a PRACH slot
are mapped to a valid PUSCH occasion and the associated DMRS resource
-	first, in increasing order of frequency resource indexes f_id for frequency multiplexed PUSCH occasions
-	second, in increasing order of DMRS resource indexes within a PUSCH occasion, where a DMRS resource index DMRS_id is determined first in an ascending order of a DMRS port index and second in an ascending order of a DMRS sequence index [4, TS 38.211]
-	third, in increasing order of time resource indexes t_id for time multiplexed PUSCH occasions within a PUSCH slot
-	fourth, in increasing order of indexes for N_s PUSCH slots
where N_"preamble" =ceil(T_"preamble" ⁄T_"PUSCH"  ), T_"preamble"  is a total number of valid PRACH occasions per association pattern period multiplied by the number of preambles per valid PRACH occasion provided by rach-ConfigCommonTwoStepRA, and T_"PUSCH"  is a total number of valid PUSCH occasions per PUSCH configuration per association pattern period multiplied by the number of DMRS resource indexes per valid PUSCH occasion provided by msgA-DMRS-Config. 
A PUSCH occasion is valid if it does not overlap in time and frequency with any valid PRACH occasion associated with either a Type-1 random access procedure or a Type-2 random access procedure. Additionally, for unpaired spectrum and for SS/PBCH blocks with indexes provided by ssb-PositionsInBurst in SIB1 or by ServingCellConfigCommon 
-	if a UE is not provided tdd-UL-DL-ConfigurationCommon, a PUSCH occasion is valid if the PUSCH occasion
-	does not precede a SS/PBCH block in the PUSCH slot, and 
-	starts at least N_"gap"  symbols after a last SS/PBCH block symbol, where N_"gap"  is provided in Table 8.1-2 and, if channelAccessMode = "semiStatic" is provided, does not overlap with a set of consecutive symbols before the start of a next channel occupancy time where the UE does not transmit [15, TS 37.213].
-	if a UE is provided tdd-UL-DL-ConfigurationCommon, a PUSCH occasion is valid if the PUSCH occasion
-	is within UL symbols, or 
-	does not precede a SS/PBCH block in the PUSCH slot, and 
-	starts at least N_"gap"  symbols after a last downlink symbol and at least N_"gap"  symbols after a last SS/PBCH block symbol, where N_"gap"  is provided in Table 8.1-2 and, if channelAccessMode = "semiStatic" is provided, does not overlap with a set of consecutive symbols before the start of a next channel occupancy time where the UE does not transmit [15, TS 37.213].
8.2	Random access response - Type-1 random access procedure
In response to a PRACH transmission, a UE attempts to detect a DCI format 1_0 with CRC scrambled by a corresponding RA-RNTI during a window controlled by higher layers [11, TS 38.321] if the PRACH transmission is not triggered by a PDCCH order that includes a Cell Indicator field with non-zero value; otherwise, the UE does not attempt to detect the DCI format 1_0. The window starts at the first symbol of the earliest CORESET the UE is configured to receive PDCCH for Type1-PDCCH CSS set, as defined in clause 10.1, that is at least one symbol, after the last symbol of the last PRACH occasion corresponding to the PRACH transmission, where the symbol duration corresponds to the SCS for Type1-PDCCH CSS set as defined in clause 10.1. If N_"TA,adj" ^"UE"  or N_"TA,adj" ^"common" , as defined in [4, TS 38.211], is not zero, the window starts after an additional T_TA+k_mac msec where T_TA is defined in [4, TS 38.211] and k_mac is provided by kmac or k_mac=0 if kmac is not provided. The length of the window in number of slots, based on the SCS for Type1-PDCCH CSS set, is provided by ra-ResponseWindow. 
If the UE detects the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI and LSBs of a SFN field in the DCI format 1_0, if included and applicable, are same as corresponding LSBs of the SFN where the UE transmitted PRACH, and the UE receives a transport block in a corresponding PDSCH within the window, the UE passes the transport block to higher layers. The higher layers parse the transport block for a random access preamble identity (RAPID) associated with the PRACH transmission. If the higher layers identify the RAPID in RAR message(s) of the transport block, the higher layers indicate an uplink grant to the physical layer. This is referred to as random access response (RAR) UL grant in the physical layer. 
If the UE does not detect the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI within the window, or if the UE detects the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI within the window and LSBs of a SFN field in the DCI format 1_0, if included and applicable, are not same as corresponding LSBs of the SFN where the UE transmitted PRACH, or if the UE does not correctly receive the transport block in the corresponding PDSCH within the window, or if the higher layers do not identify the RAPID associated with the PRACH transmission from the UE, the higher layers can indicate to the physical layer to transmit a PRACH. If requested by higher layers, the UE shall be ready to transmit a PRACH no later than N_(T,1)+0.75 msec after the last symbol of the window, or the last symbol of the PDSCH reception, where N_(T,1) is a time duration of N_1 symbols corresponding to a PDSCH processing time for UE processing capability 1 assuming μ corresponds to the smallest SCS configuration among the SCS configurations for the PDCCH carrying the DCI format 1_0, the corresponding PDSCH when additional PDSCH DM-RS is configured, and the corresponding PRACH. For μ=0, the UE assumes N_1,0=14 [6, TS 38.214]. For a PRACH transmission using 1.25 kHz or 5 kHz SCS, the UE determines N_1 assuming SCS configuration μ=0.
If the UE detects a DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI and LSBs of a SFN field in the DCI format 1_0, if included and applicable, are same as corresponding LSBs of the SFN where the UE transmitted the PRACH, and the UE receives a transport block in a corresponding PDSCH, the UE may assume same DM-RS antenna port quasi co-location properties, as described in [6, TS 38.214], as for a SS/PBCH block or a CSI-RS resource the UE used for PRACH association, as described in clause 8.1, regardless of whether or not the UE is provided TCI-State for the CORESET where the UE receives the PDCCH with the DCI format 1_0. 
For the CFRA procedure triggered by LTM Cell Switch Command MAC CE, if the UE detects a DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI and the UE receives a transport block in a corresponding PDSCH, the UE may assume same DM-RS antenna port quasi co-location properties, as described in [6, TS 38.214], as for a SS/PBCH block the UE used for PRACH association, as described in clause 8.1.
If the UE attempts to detect the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI in response to a PRACH transmission initiated by a PDCCH order that triggers a contention-free random access procedure for the SpCell [11, TS 38.321], the UE may assume that the PDCCH that includes the DCI format 1_0 and the PDCCH order have same DM-RS antenna port quasi co-location properties. If the UE attempts to detect the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI in response to a PRACH transmission initiated by a PDCCH order that triggers a contention-free random access procedure for a secondary cell, or if the UE is configured with tag2-Id for the SpCell and the CORESET where the UE receives the PDCCH order that triggers a contention-free random access procedure for the SpCell is not associated with the physical cell ID for the serving cell, the UE may assume the DM-RS antenna port quasi co-location properties of the CORESET associated with the Type1-PDCCH CSS set for receiving the PDCCH that includes the DCI format 1_0 and the PDSCH scheduled by the DCI format 1_0.
A RAR UL grant schedules a PUSCH transmission from the UE. The contents of the RAR UL grant, starting with the MSB and ending with the LSB, are given in Table 8.2-1. 
If the value of the frequency hopping flag is 0, the UE transmits the PUSCH without frequency hopping; otherwise, the UE transmits the PUSCH with frequency hopping.
The UE determines the MCS of the PUSCH transmission from the first sixteen indexes of the applicable MCS index table for PUSCH as described in [6, TS 38.214]. 
The TPC command value δ_(msg2,b,f,c) is used for setting the power of the PUSCH transmission, as described in clause 7.1.1, and is interpreted according to Table 8.2-2. 
The CSI request field is reserved. 
The ChannelAccess-CPext field indicates a channel access type and CP extension for operation with shared spectrum channel access [15, TS 37.213] in FR1 as defined in Table 7.3.1.1.1-4 in [5, TS 38.212] or Table 7.3.1.1.1-4A in [5, TS 38.212] if channelAccessMode = "semiStatic" is provided. The ChannelAccess-CPext field indicates a channel access type for operation with shared spectrum channel access [15, TS 37.213] in FR2-2 as defined in Table 7.3.1.1.1-4B in [5, TS 38.212] if ChannelAccessMode2-r17 is provided.
Table 8.2-1: Random Access Response Grant Content field size
RAR grant field	Number of bits
Frequency hopping flag	1
PUSCH frequency resource allocation	12, for operation with shared spectrum channel access in FR1 or for FR2-2 when ChannelAccessMode2-r17 is provided
14, otherwise
PUSCH time resource allocation	4
MCS	4
TPC command for PUSCH	3
CSI request	1
ChannelAccess-CPext	2, for operation with shared spectrum channel access in FR1 or for FR2-2 when ChannelAccessMode2-r17 is provided
0, otherwise

Table 8.2-2: TPC Command δ_(msg2,b,f,c) for PUSCH
TPC Command	Value (in dB)
0	-6
1	-4
2	-2
3	0
4	2
5	4
6	6
7	8

Unless the UE is configured a SCS, the UE receives subsequent PDSCH using same SCS as for the PDSCH reception providing the RAR message.
If the UE does not detect the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI within the window, or if the UE detects the DCI format 1_0 with CRC scrambled by the corresponding RA-RNTI within the window and the LSBs of a SFN field in the DCI format 1_0, if included and applicable, are not same as corresponding LSBs of the SFN where the UE transmitted the PRACH, or the UE does not correctly receive a corresponding transport block within the window, the UE procedure is as described in [11, TS 38.321]. 
8.2A	Random access response - Type-2 random access procedure
In response to a transmission of a PRACH and a PUSCH, or to a transmission of only a PRACH if the PRACH preamble is mapped to a valid PUSCH occasion, a UE attempts to detect a DCI format 1_0 with CRC scrambled by a corresponding MsgB-RNTI during a window controlled by higher layers [11, TS 38.321]. The window starts at the first symbol of the earliest CORESET the UE is configured to receive PDCCH for Type1-PDCCH CSS set, as defined in clause 10.1, that is at least one symbol, after the last symbol of the PUSCH occasion corresponding to the PRACH transmission, where the symbol duration corresponds to the SCS for Type1-PDCCH CSS set. If N_"TA,adj" ^"UE"  or N_"TA,adj" ^"common" , as defined in [4, TS 38.211], is not zero, the window starts after an additional T_TA+k_mac msec where T_TA is defined in [4, TS 38.211] and k_mac is provided by kmac or k_mac=0 if kmac is not provided. The length of the window in number of slots, based on the SCS for Type1-PDCCH CSS set, is provided by msgB-ResponseWindow.
In response to a transmission of a PRACH, if the PRACH preamble is not mapped to a valid PUSCH occasion, a UE attempts to detect a DCI format 1_0 with CRC scrambled by a corresponding MsgB-RNTI during a window controlled by higher layers [11, TS 38.321]. The window starts at the first symbol of the earliest CORESET the UE is configured to receive PDCCH for Type1-PDCCH CSS set, as defined in clause 10.1, that is at least one symbol, after the last symbol of the PRACH occasion corresponding to the PRACH transmission, where the symbol duration corresponds to the SCS for Type1-PDCCH CSS set. The length of the window in number of slots, based on the SCS for Type1-PDCCH CSS set, is provided by msgB-ResponseWindow.
If the UE detects the DCI format 1_0, with CRC scrambled by the corresponding MsgB-RNTI and LSBs of a SFN field in the DCI format 1_0, if applicable, are same as corresponding LSBs of the SFN where the UE transmitted PRACH, and the UE receives a transport block in a corresponding PDSCH within the window, the UE passes the transport block to higher layers. The higher layers indicate to the physical layer
-	an uplink grant if the RAR message(s) is for fallbackRAR and a random access preamble identity (RAPID) associated with the PRACH transmission is identified, and the UE procedure continues as described in clauses 8.2, 8.3, and 8.4 when the UE detects a RAR UL grant, or
-	transmission of a PUCCH with HARQ-ACK information having ACK value if the RAR message(s) is for successRAR, where 
-	a PUCCH resource for the transmission of the PUCCH is indicated by PUCCH resource indicator field of 4 bits in the successRAR from a PUCCH resource set that is provided by pucch-ResourceCommon 
-	a slot for the PUCCH transmission is indicated by a HARQ Feedback Timing Indicator field of 3 bits in the successRAR having a value k from {1, 2, 3, 4, 5, 6, 7, 8} for μ≤3, from {7, 8, 12, 16, 20, 24, 28, 32} for μ=5, and from {13, 16, 24, 32, 40, 48, 56, 64} for μ=6 and, with reference to slots for PUCCH transmission having duration T_slot, the slot is determined as n+k+∆〖+2〗^μ∙K_(cell,offset), where n is the last slot that overlaps with the DL slot for the PDSCH reception, ∆ is as defined for PUSCH transmission in Table 6.1.2.1.1-5 of [6, TS 38.214], μ is the SCS configuration of the active UL BWP, and K_(cell,offset) is provided by cellSpecificKoffset; otherwise, if not provided, K_(cell,offset)=0
-	the UE does not expect the first symbol of the PUCCH transmission to be after the last symbol of the PDSCH reception by a time smaller than N_(T,1)+0.5 msec where N_(T,1) is the PDSCH processing time for UE processing capability 1 [6, TS 38.214]
-	for operation with shared spectrum channel access in FR1, a channel access type and CP extension [15, TS 37.213] for a PUCCH transmission is indicated by a ChannelAccess-CPext field in the successRAR as defined in Table 7.3.1.1.1-4 in [5, TS 38.212] or Table 7.3.1.1.1-4A in [5, TS 38.212] if channelAccessMode = "semiStatic" is provided
-	for operation with shared spectrum channel access in FR2-2, a channel access type [15, TS 37.213] for a PUCCH transmission is indicated by a ChannelAccess-CPext field in the successRAR as defined in Table 7.3.1.1.1-4B in [5, TS 38.212] if ChannelAccessMode2-r17 is provided
-	the PUCCH transmission is with a same spatial domain transmission filter and in a same active UL BWP as a last PUSCH transmission
If the UE detects the DCI format 1_0 with CRC scrambled by a C-RNTI and a transport block in a corresponding PDSCH within the window, the UE transmits a PUCCH with HARQ-ACK information having ACK value if the UE correctly detects the transport block or NACK value if the UE incorrectly detects the transport block and the time alignment timer is running [11, TS 38.321]. 
If the UE detects a DCI format 1_0 with CRC scrambled by the corresponding MsgB-RNTI and receives a transport block within the window in a corresponding PDSCH, the UE may assume same DM-RS antenna port quasi co-location properties, as described in [6, TS 38.214], as for a SS/PBCH block the UE used for PRACH association, as described in clause 8.1, regardless of whether or not the UE is provided TCI-State for the CORESET where the UE receives the PDCCH with the DCI format 1_0.
The UE does not expect to be indicated to transmit the PUCCH with the HARQ-ACK information at a time that is prior to a time when the UE applies a TA command that is provided by the transport block. If the UE does not detect the DCI format 1_0 with CRC scrambled by the corresponding MsgB-RNTI within the window, or if the UE detects the DCI format 1_0 with CRC scrambled by the corresponding MsgB-RNTI within the window and LSBs of a SFN field in the DCI format 1_0, if applicable, are not same as corresponding LSBs of the SFN where the UE transmitted the PRACH, or if the UE does not correctly receive the transport block in the corresponding PDSCH within the window, or if the higher layers do not identify the RAPID associated with the PRACH transmission from the UE, the higher layers can indicate to the physical layer to transmit only PRACH according to Type-1 random access procedure or to transmit both PRACH and PUSCH according to Type-2 random access procedure [11, TS 38.321]. If requested by higher layers, the UE shall be ready to transmit a PRACH no later than N_"T,1" +0.75 msec after the last symbol of the window, or the last symbol of the PDSCH reception, where N_"T,1"  is a time duration of N_1 symbols corresponding to a PDSCH processing time for UE processing capability 1 when additional PDSCH DM-RS is configured. For μ=0, the UE assumes N_"1,0" =14 [6, TS 38.214].
Unless the UE is configured a SCS, the UE receives subsequent PDSCH using same SCS as for the PDSCH reception providing the RAR message.
If the UE does not detect the DCI format 1_0 with CRC scrambled by the corresponding MsgB-RNTI within the window, or if the UE detects the 1_0 with CRC scrambled by the corresponding MsgB-RNTI within the window and LSBs of a SFN field in the DCI format 1_0, if applicable, are not same as corresponding LSBs of the SFN where the UE transmitted the PRACH, or the UE does not correctly receive a corresponding transport block within the window, the UE procedure is as described in [11, TS 38.321].
8.3	PUSCH scheduled by RAR UL grant
An active UL BWP with SCS configuration μ, as described in clause 12 and in [4, TS 38.211], for a PUSCH transmission scheduled by a RAR UL grant is indicated by higher layers. 
If useInterlacePUCCH-PUSCH is not provided by BWP-UplinkCommon and BWP-UplinkDedicated, for determining the frequency domain resource allocation for the PUSCH transmission within the active UL BWP
-	if the active UL BWP and the initial UL BWP have same SCS and same CP length and the active UL BWP includes all RBs of the initial UL BWP, or the active UL BWP is the initial UL BWP, the initial UL BWP is used 
-	else, the RB numbering starts from the first RB of the active UL BWP and the maximum number of RBs for frequency domain resource allocation equals the number of RBs in the initial UL BWP
The frequency domain resource allocation is by uplink resource allocation type 1 [6, TS 38.214]. For an initial UL BWP size of N_"BWP" ^"size"  RBs, a UE processes the frequency domain resource assignment field as follows
-	if N_"BWP" ^"size" ≤180, or for operation with shared spectrum channel access in FR1 or for FR2-2 when ChannelAccessMode2-r17 is provided if N_"BWP" ^"size" ≤90
-	truncate the frequency domain resource assignment field to its ⌈〖"log" 〗_2 ((N_"BWP" ^"size" ∙(N_"BWP" ^"size" +1))⁄2)⌉ least significant bits and interpret the truncated frequency resource assignment field as for the frequency resource assignment field in DCI format 0_0 as described in [5, TS 38.212] 
-	else
-	insert 
-	⌈〖"log" 〗_2 ((N_"BWP" ^"size" ∙(N_"BWP" ^"size" +1))⁄2)⌉-12 most significant bits, for operation with shared spectrum channel access in FR1 or for FR2-2 when ChannelAccessMode2-r17 is provided;
-	⌈〖"log" 〗_2 ((N_"BWP" ^"size" ∙(N_"BWP" ^"size" +1))⁄2)⌉-14 most significant bits, otherwise;
with value set to '0' after the N_(UL,hop) bits to the frequency domain resource assignment field, where N_(UL,hop)=0  if the frequency hopping flag is set to '0' and N_(UL,hop) is provided in Table 8.3-1 if the hopping flag bit is set to '1', and interpret the expanded frequency resource assignment field as for the frequency resource assignment field in DCI format 0_0 as described in [5, TS 38.212]
-	end if
If the PUSCH transmission is in SBFD symbols and associated with a PRACH transmission in second PRACH occasions, as described in clause 11.1, N_"BWP" ^"size"  in Table 8.3-1 is the number of RBs that are both in the active UL BWP and in the UL sub-band for the determination of the frequency offset for the second hop.
If useInterlacePUCCH-PUSCH is provided by BWP-UplinkCommon or BWP-UplinkDedicated, the frequency domain resource allocation is by uplink resource allocation type 2 [6, TS 38.214]. A UE processes the frequency domain resource assignment field as follows
-	truncate the frequency domain resource assignment field to the X=6 LSBs if μ=0, or to the X=5 LSBs if μ=1  
-	for interlace allocation of a PUSCH transmission, interpret the X MSBs of the truncated frequency domain resource assignment field for the active UL BWP as for the X MSBs of the frequency domain resource assignment field in DCI format 0_0 [6, TS 38.214]
-	for RB set allocation of a PUSCH transmission, the RB set of the active UL BWP is the RB set of the PRACH transmission associated with the RAR UL grant. The UE assumes that the RB set is defined as when the UE is not provided intraCellGuardBandsUL-List [6, TS 38.214].
A UE determines whether or not to apply transform precoding as described in [6, TS 38.214]. 
For a PUSCH transmission with frequency hopping scheduled by RAR UL grant or for a Msg3 PUSCH retransmission, the frequency offset for the second hop [6, TS 38.214] is given in Table 8.3-1.
Table 8.3-1: Frequency offset for second hop of PUSCH transmission with frequency hopping scheduled by RAR UL grant or of Msg3 PUSCH retransmission
Number of PRBs in initial UL BWP	Value of N_(UL,hop) Hopping Bits	Frequency offset for 2nd hop
N_"BWP" ^"size" <50	0	⌊(N_"BWP" ^"size" )⁄2⌋
	1	⌊(N_"BWP" ^"size" )⁄4⌋
N_"BWP" ^"size" ≥50	00	⌊(N_"BWP" ^"size" )⁄2⌋
	01	⌊(N_"BWP" ^"size" )⁄4⌋
	10	-⌊(N_"BWP" ^"size" )⁄4⌋
	11	Reserved

A SCS for the PUSCH transmission is provided by subcarrierSpacing in BWP-UplinkCommon. A UE transmits PRACH and the PUSCH on a same uplink carrier of a same serving cell. 
A UE transmits a transport block in a PUSCH scheduled by a RAR UL grant in a corresponding RAR message using redundancy version number 0, if the PUSCH transmission is without repetitions. If a TC-RNTI is provided by higher layers, the scrambling initialization of the PUSCH corresponding to the RAR UL grant in clause 8.2 is by TC-RNTI. Otherwise, the scrambling initialization of the PUSCH corresponding to the RAR UL grant in clause 8.2 is by C-RNTI. 
If a UE is provided tag2-Id, the UE transmits a transport block in a PUSCH scheduled by a RAR UL grant in a corresponding RAR message with timing advance corresponding to a TAG indicated by the RAR message. 
Msg3 PUSCH retransmissions, if any, of the transport block, are scheduled by a DCI format 0_0 with CRC scrambled by a TC-RNTI provided in the corresponding RAR message [11, TS 38.321]. 
With reference to slots for a PUSCH transmission scheduled by a RAR UL grant, if a UE receives a PDSCH with a RAR message ending in slot n for a corresponding PRACH transmission from the UE, the UE transmits the PUSCH in slot n+k_2+∆+2^μ∙K_(cell,offset), where k_2 and ∆ are provided in [6, TS 38.214] and K_(cell,offset) is provided by cellSpecificKoffset; otherwise, if not provided, K_(cell,offset)=0. 
A UE can be provided in BWP-UplinkCommon a set of numbers of repetitions for a PUSCH transmission with PUSCH repetition Type A that is scheduled by a RAR UL grant or by a DCI format 0_0 with CRC scrambled by a TC-RNTI. The UE does not apply sbfd-Config2-Transmission, if provided for a PUSCH transmission with repetitions. If the UE requests repetitions for the PUSCH transmission [11, TS 38.321], the UE transmits the PUSCH over N_"PUSCH" ^"repeat"  slots, where N_"PUSCH" ^"repeat"  is indicated by the 2 MSBs of the MCS field in the RAR UL grant or in the DCI format 0_0 from a set of four values provided by numberOfMsg3-RepetitionsList or from {1, 2, 3, 4} if numberOfMsg3-RepetitionsList is not provided. The UE determines an MCS for the PUSCH transmission by the 2 LSBs of the MCS field in the RAR UL grant or by the 3 LSBs of the MCS field in the DCI format 0_0, and determines a redundancy version and RBs for each repetition as described in [6, TS 38.214]. For unpaired spectrum operation, the UE determines the N_"PUSCH" ^"repeat"  slots as the first N_"PUSCH" ^"repeat"  slots starting from slot n+k_2+∆+2^μ∙K_(cell,offset) where a repetition of the PUSCH transmission does not include a symbol indicated as downlink by tdd-UL-DL-ConfigurationCommon or indicated as a symbol of an SS/PBCH block with index provided by ssb-PositionsInBurst, and where K_(cell,offset) is provided by cellSpecificKoffset; otherwise, if not provided, K_(cell,offset)=0. For paired spectrum operation, the UE determines the N_"PUSCH" ^"repeat"  slots as the first N_"PUSCH" ^"repeat"  slots starting from slot n+k_2+∆+2^μ∙K_(cell,offset) where K_(cell,offset) is provided by cellSpecificKoffset; otherwise, if not provided, K_(cell,offset)=0.
The UE may assume a minimum time between the last symbol of a PDSCH reception conveying a RAR message with a RAR UL grant and the first symbol of a corresponding PUSCH transmission scheduled by the RAR UL grant is equal to N_(T,1)+N_(T,2)+0.5 msec, where N_(T,1) is a time duration of N_1 symbols corresponding to a PDSCH processing time for UE processing capability 1 when additional PDSCH DM-RS is configured, N_(T,2) is a time duration of N_2 symbols corresponding to a PUSCH preparation time for UE processing capability 1 [6, TS 38.214] and, for determining the minimum time, the UE considers that N_1 and N_2 correspond to the smaller of the SCS configurations for the PDSCH and the PUSCH. For μ=0, the UE assumes N_1,0=14 [6, TS 38.214].
8.4	PDSCH with UE contention resolution identity
In response to a PUSCH transmission scheduled by a RAR UL grant or corresponding PUSCH retransmission scheduled by a DCI format 0_0 with CRC scrambled by a TC-RNTI provided in the corresponding RAR message when a UE has not been provided a C-RNTI, the UE attempts to detect a DCI format 1_0 with CRC scrambled by a corresponding TC-RNTI scheduling a PDSCH that includes a UE contention resolution identity [11, TS 38.321]. If SIB1 provides msg4-NumberofRepetitions, the UE may indicate FG-XYZ in the PUSCH transmission. 
In response to the PDSCH reception with the UE contention resolution identity, the UE transmits HARQ-ACK information in a PUCCH. The PUCCH transmission is within a same active UL BWP as the PUSCH transmission. A minimum time between the last symbol of the PDSCH reception and the first symbol of the corresponding PUCCH transmission with the HARQ-ACK information is equal to N_(T,1)+0.5 msec. N_(T,1) is a time duration of N_1 symbols corresponding to a PDSCH processing time for UE processing capability 1 when additional PDSCH DM-RS is configured. For μ=0, the UE assumes N_1,0=14 [6, TS 38.214].
When detecting a DCI format in response to a PUSCH transmission scheduled by a RAR UL grant, as described in [11, TS 38.321], or corresponding PUSCH retransmission scheduled by a DCI format 0_0 with CRC scrambled by a TC-RNTI provided in the corresponding RAR message [11, TS 38.321], the UE may assume the PDCCH carrying the DCI format has the same DM-RS antenna port quasi co-location properties, as described in [6, TS 38.214], as for a SS/PBCH block the UE used for PRACH association, as described in clause 8.1, regardless of whether or not the UE is provided TCI-State for the CORESET where the UE receives the PDCCH with the DCI format.
